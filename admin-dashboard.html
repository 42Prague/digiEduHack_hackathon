<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Admin Dashboard</title>
    <style>
      :root{--accent:#941C2F}
      html,body{height:100%;margin:0}
      body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#2a0709;color:#fff;display:flex;flex-direction:column;min-height:100vh}
      header{background:rgba(0,0,0,0.3);padding:20px;border-bottom:1px solid rgba(255,255,255,0.1);display:flex;justify-content:space-between;align-items:center}
      header h1{margin:0;font-size:24px;color:#fff}
      .logout-btn{padding:10px 20px;border-radius:8px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;text-decoration:none}
      .logout-btn:hover{opacity:0.9}
      .container{flex:1;padding:40px 20px;max-width:1200px;margin:0 auto;width:100%}
      .card{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:30px;margin-bottom:20px}
      .card h2{margin-top:0;color:var(--accent)}
      .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:20px}
      .stat-box{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);padding:20px;border-radius:8px;text-align:center}
      .stat-box .number{font-size:32px;font-weight:700;color:var(--accent)}
      .stat-box .label{font-size:14px;color:rgba(255,255,255,0.7);margin-top:8px}
      .charts-grid{display:grid;grid-template-columns:2fr 1fr;gap:20px;align-items:start;margin-bottom:20px}
      .chart-card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);padding:16px;border-radius:12px}
      .chart-card strong{display:block;margin-bottom:12px}
      .chart-card canvas{margin-top:12px}
      .chart-stack{display:flex;flex-direction:column;gap:16px}
      canvas{max-width:100%;height:240px}
      .data-table{width:100%;border-collapse:collapse;margin-top:12px}
      .data-table th,.data-table td{padding:8px;border:1px solid rgba(255,255,255,0.06);text-align:left;color:#fff}
      .data-table th{background:rgba(255,255,255,0.03);color:var(--accent)}
      .data-table td[contenteditable]{background:transparent}
      .dept-list{margin-top:14px;display:flex;flex-direction:column;gap:8px}
      .dept-row{display:flex;align-items:center;justify-content:space-between;padding:6px 4px;border-radius:6px}
      .dept-row .left{display:flex;align-items:center}
      .swatch{width:12px;height:12px;border-radius:3px;margin-right:8px;display:inline-block}
      .dept-name{color:#fff}
      .dept-value{min-width:50px;text-align:right;color:#fff;padding:2px 6px;border-radius:4px;background:rgba(255,255,255,0.02)}
      .dept-value[contenteditable]{outline:none}
      .menu{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:20px}
      .menu-btn{padding:15px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#fff;text-decoration:none;text-align:center;cursor:pointer;transition:all 0.3s}
      .menu-btn:hover{background:var(--accent);border-color:var(--accent)}
      .user-menu{position:relative}
      .user-icon{width:40px;height:40px;background:rgba(255,255,255,0.1);border:2px solid var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:24px;transition:all 0.3s;color:#999}
      .user-icon:hover{background:rgba(255,255,255,0.15)}
      .dropdown{position:absolute;top:100%;right:0;background:#0b0b0b;border:1px solid rgba(255,255,255,0.1);border-radius:8px;min-width:150px;margin-top:8px;display:none;flex-direction:column;z-index:1000;box-shadow:0 8px 24px rgba(0,0,0,0.5)}
      .dropdown.active{display:flex}
      .dropdown a{padding:12px 16px;color:#fff;text-decoration:none;font-size:14px;display:flex;align-items:center;border-bottom:1px solid rgba(255,255,255,0.05);transition:all 0.3s}
      .dropdown a:last-child{border-bottom:none}
      .dropdown a:hover{background:var(--accent);color:#fff}
      .search-container{display:flex;align-items:center;gap:8px;background:#000;border:none;border-radius:20px;padding:10px 16px;flex:0 1 auto}
      .search-container input{background:transparent;border:none;color:#fff;font-size:14px;width:200px;outline:none}
      .search-container input::placeholder{color:rgba(255,255,255,0.5)}
      .search-icon{cursor:pointer;color:#fff;transition:color 0.3s;margin-right:4px;display:flex;align-items:center;justify-content:center}
      .search-icon:hover{color:rgba(255,255,255,0.8)}
    </style>
  </head>
  <body>
    <header>
      <h1 id="headerTitle">Admin Dashboard</h1>
      <div class="user-menu">
        <div class="user-icon" id="userIconAdmin">ðŸ‘¤</div>
        <div class="dropdown" id="dropdownAdmin">
          <a href="#">Info</a>
          <a href="#">Profile</a>
          <a href="index.html">Logout</a>
        </div>
      </div>
    </header>
    <div class="container">
      <div class="card">
        <h2>System Statistics</h2>
        <div class="charts-grid">
          <div class="chart-column chart-stack">
            <div class="chart-card">
              <strong style="color:var(--accent);">Enrollment by Grade</strong>
              <canvas id="enrollmentChart"></canvas>
            </div>
            <div class="chart-card">
              <strong style="color:var(--accent);">Attendance (Last 6 Months)</strong>
              <canvas id="attendanceChart"></canvas>
            </div>
          </div>
          <div>
            <div class="chart-card">
              <strong style="color:var(--accent);">Enrollment by Department</strong>
              <canvas id="deptChart"></canvas>
              <div id="deptList" class="dept-list" aria-live="polite"></div>
            </div>
            <div class="chart-card" style="margin-top:16px;">
              <strong style="color:var(--accent);">Key Figures</strong>
              <table class="data-table">
                <thead>
                  <tr><th>Metric</th><th>Value</th><th>Notes</th></tr>
                </thead>
                <tbody>
                  <tr><td>Students</td><td contenteditable="true">1,250</td><td contenteditable="true">Current enrollment</td></tr>
                  <tr><td>Teachers</td><td contenteditable="true">45</td><td contenteditable="true">Full-time</td></tr>
                  <tr><td>Courses</td><td contenteditable="true">18</td><td contenteditable="true">Active this term</td></tr>
                  <tr><td>Avg. Attendance</td><td contenteditable="true">95%</td><td contenteditable="true">Last month</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="menu" id="adminFilters">
          <div class="menu-btn" style="display:flex;flex-direction:column;align-items:flex-start;gap:8px;">
            <label for="filterRegion" style="font-size:12px;color:rgba(255,255,255,0.8);">Region</label>
            <select id="filterRegion" style="min-width:120px;padding:8px;border-radius:6px;color:#000;background:#fff;">
              <option value="">-- Select --</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
            </select>
          </div>

          <div class="menu-btn" style="display:flex;flex-direction:column;align-items:flex-start;gap:8px;">
            <label for="filterSchool" style="font-size:12px;color:rgba(255,255,255,0.8);">School Name</label>
            <input id="filterSchool" type="text" placeholder="Enter school name" style="min-width:160px;padding:8px;border-radius:6px;border:0;">
          </div>

          <div class="menu-btn" style="display:flex;flex-direction:column;align-items:flex-start;gap:8px;">
            <label style="font-size:12px;color:rgba(255,255,255,0.8);">Date</label>
            <div style="display:flex;gap:6px;align-items:center;">
              <input id="filterDay" type="number" min="1" max="31" placeholder="DD" inputmode="numeric" style="width:56px;padding:8px;border-radius:6px;color:#000;background:#fff;">
              <span style="color:rgba(255,255,255,0.6);">/</span>
              <input id="filterMonth" type="number" min="1" max="12" placeholder="MM" inputmode="numeric" style="width:56px;padding:8px;border-radius:6px;color:#000;background:#fff;">
              <span style="color:rgba(255,255,255,0.6);">/</span>
              <input id="filterYear" type="number" min="0" max="99" placeholder="YY" inputmode="numeric" style="width:72px;padding:8px;border-radius:6px;color:#000;background:#fff;">
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="search-container" style="display:flex;align-items:center;gap:8px;background:#000;border:none;border-radius:20px;padding:10px 16px;flex:0 1 auto;justify-content:center;margin:0 auto;">
          <input type="text" id="searchInput" placeholder="Search...">
          <span class="search-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg></span>
        </div>
      </div>
    </div>
  </body>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const userIcon = document.getElementById('userIconAdmin');
    const dropdown = document.getElementById('dropdownAdmin');
    const searchInput = document.getElementById('searchInput');
    const searchIcon = document.querySelector('.search-icon');

    userIcon.addEventListener('click', function(e){
      e.stopPropagation();
      dropdown.classList.toggle('active');
    });

    document.addEventListener('click', function(){
      dropdown.classList.remove('active');
    });

    dropdown.addEventListener('click', function(e){
      e.stopPropagation();
    });

    // Search functionality
    searchIcon.addEventListener('click', function(){
      const query = searchInput.value.trim();
      if(query){
        alert('Demo: Searching for "' + query + '"');
        searchInput.value = '';
      }
    });

    searchInput.addEventListener('keypress', function(e){
      if(e.key === 'Enter'){
        const query = this.value.trim();
        if(query){
          alert('Demo: Searching for "' + query + '"');
          this.value = '';
        }
      }
    });

    // Load and display username
    const username = localStorage.getItem('username');
    if(username){
      document.getElementById('headerTitle').textContent = `Welcome, ${username}!`;
    }

    // --- Chart configuration (easy to edit) ---
    const enrollmentLabels = ['Grade 1','Grade 2','Grade 3','Grade 4','Grade 5','Grade 6'];
    const enrollmentData = [120, 200, 180, 150, 140, 160];

    const attendanceLabels = ['Jun','Jul','Aug','Sep','Oct','Nov'];
    const attendanceData = [92,94,95,93,96,95];

    const deptLabels = ['Science','Math','English','History','Arts'];
    const deptData = [320,280,240,180,150];

    // create charts after DOM ready
    function createCharts(){
      const ctxEnroll = document.getElementById('enrollmentChart').getContext('2d');
      window.enrollmentChart = new Chart(ctxEnroll, {
        type: 'bar',
        data: {labels: enrollmentLabels, datasets:[{label:'Students',data:enrollmentData, backgroundColor:'rgba(148,28,47,0.85)'}]},
        options: {responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
      });

      const ctxAttend = document.getElementById('attendanceChart').getContext('2d');
      window.attendanceChart = new Chart(ctxAttend, {
        type: 'line',
        data: {labels: attendanceLabels, datasets:[{label:'Attendance %',data:attendanceData, borderColor:'rgba(148,28,47,0.9)', backgroundColor:'rgba(148,28,47,0.15)', fill:true}]},
        options: {responsive:true, plugins:{legend:{display:false}}, scales:{y:{suggestedMin:80, suggestedMax:100}}}
      });

      const ctxDept = document.getElementById('deptChart').getContext('2d');
      window.deptChart = new Chart(ctxDept, {
        type: 'doughnut',
        data: {labels: deptLabels, datasets:[{data:deptData, backgroundColor:['#941C2F','#E06666','#F7A6A6','#C24747','#7B1B1B']}]},
        options: {responsive:true, plugins:{legend:{display:false}}, cutout: '55%'}
      });

      // populate the department list (labels + values) and wire editing
      populateDeptList();
    }

    // call createCharts when DOM is ready
    if(document.readyState === 'loading'){
      document.addEventListener('DOMContentLoaded', createCharts);
    } else {
      createCharts();
    }

    // Optional: refresh charts from table values (simple example)
    function refreshFromTable(){
      try{
        const table = document.querySelector('.data-table');
        if(!table) return;
        const rows = Array.from(table.querySelectorAll('tbody tr'));
        // update enrollment number (students) into enrollmentChart first bar
        const studentsCell = rows[0].children[1];
        const studentsVal = parseInt(studentsCell.textContent.replace(/[^0-9]/g,'')) || enrollmentData[0];
        window.enrollmentChart.data.datasets[0].data[0] = studentsVal;
        window.enrollmentChart.update();
        // also refresh dept list values from table if table contains matching metrics
        // (if a table cell has department names/values you'd extend this mapping)
        if(window.deptChart) populateDeptList();
      }catch(e){console.warn('Refresh failed',e)}
    }

    // Listen for table edits and refresh charts (debounced)
    let refreshTimer = null;
    document.addEventListener('input', function(e){
      if(e.target && e.target.closest && e.target.closest('.data-table')){
        clearTimeout(refreshTimer);
        refreshTimer = setTimeout(refreshFromTable, 600);
      }
    });

    // --- Department list helpers ---
    function populateDeptList(){
      const container = document.getElementById('deptList');
      if(!container || !window.deptChart) return;
      const labels = window.deptChart.data.labels;
      const data = window.deptChart.data.datasets[0].data;
      const colors = window.deptChart.data.datasets[0].backgroundColor || [];
      container.innerHTML = '';
      labels.forEach((lab, i) => {
        const row = document.createElement('div');
        row.className = 'dept-row';
        row.dataset.index = i;

        const left = document.createElement('div'); left.className = 'left';
        const sw = document.createElement('span'); sw.className = 'swatch'; sw.style.backgroundColor = colors[i] || '#888';
        const name = document.createElement('span'); name.className = 'dept-name'; name.textContent = lab;
        left.appendChild(sw); left.appendChild(name);

        const val = document.createElement('span'); val.className = 'dept-value'; val.contentEditable = true; val.textContent = data[i];
        // update chart on edit (debounced)
        let t = null;
        val.addEventListener('input', function(){
          clearTimeout(t);
          t = setTimeout(()=>{
            const v = parseInt(this.textContent.replace(/[^0-9]/g,'')) || 0;
            window.deptChart.data.datasets[0].data[i] = v;
            window.deptChart.update();
          }, 400);
        });

        row.appendChild(left);
        row.appendChild(val);
        container.appendChild(row);
      });
    }

    // --- Filter controls (Region, School, Date as DD/MM/YY numeric inputs) ---
    const filterRegion = document.getElementById('filterRegion');
    const filterSchool = document.getElementById('filterSchool');
    const filterDay = document.getElementById('filterDay');
    const filterMonth = document.getElementById('filterMonth');
    const filterYear = document.getElementById('filterYear');

    function isValidDMY(d, m, y){
      // allow all empty
      if((d === '' || d == null) && (m === '' || m == null) && (y === '' || y == null)) return true;
      const dd = parseInt(d,10);
      const mm = parseInt(m,10);
      const yy = parseInt(y,10);
      if(isNaN(dd) || isNaN(mm) || isNaN(yy)) return false;
      if(mm < 1 || mm > 12) return false;
      const fullYear = 2000 + (yy % 100);
      const mdays = [31, ((fullYear % 4 === 0 && (fullYear % 100 !== 0 || fullYear % 400 === 0)) ? 29 : 28),31,30,31,30,31,31,30,31,30,31];
      if(dd < 1 || dd > mdays[mm - 1]) return false;
      return true;
    }

    function formatDMY(d, m, y){
      if((d === '' || d == null) && (m === '' || m == null) && (y === '' || y == null)) return '';
      const dd = String(d || '').padStart(2,'0');
      const mm = String(m || '').padStart(2,'0');
      const yy = String(y || '').padStart(2,'0').slice(-2);
      return `${dd}/${mm}/${yy}`;
    }

    // sanitize numeric inputs and clamp ranges
    [filterDay, filterMonth, filterYear].forEach(el => {
      if(!el) return;
      el.addEventListener('input', function(){
        // allow only digits
        this.value = this.value.replace(/\D+/g,'');
        if(this.id === 'filterDay'){
          if(this.value !== ''){
            let n = parseInt(this.value,10);
            if(isNaN(n)) { this.value = ''; return; }
            if(n < 1) n = 1;
            if(n > 31) n = 31;
            this.value = String(n);
          }
        }
        if(this.id === 'filterMonth'){
          if(this.value !== ''){
            let n = parseInt(this.value,10);
            if(isNaN(n)) { this.value = ''; return; }
            if(n < 1) n = 1;
            if(n > 12) n = 12;
            this.value = String(n);
          }
        }
        if(this.id === 'filterYear'){
          if(this.value !== ''){
            let n = parseInt(this.value,10);
            if(isNaN(n)) { this.value = ''; return; }
            if(n < 0) n = 0;
            if(n > 99) n = 99;
            this.value = String(n);
          }
        }
      });

      el.addEventListener('blur', function(){
        if(this.value === '') return;
        if(this.id === 'filterDay'){
          let n = parseInt(this.value,10);
          if(isNaN(n)) { this.value = ''; return; }
          if(n < 1) n = 1; if(n > 31) n = 31; this.value = String(n).padStart(2,'0');
        }
        if(this.id === 'filterMonth'){
          let n = parseInt(this.value,10);
          if(isNaN(n)) { this.value = ''; return; }
          if(n < 1) n = 1; if(n > 12) n = 12; this.value = String(n).padStart(2,'0');
        }
        if(this.id === 'filterYear'){
          let n = parseInt(this.value,10);
          if(isNaN(n)) { this.value = ''; return; }
          if(n < 0) n = 0; if(n > 99) n = 99; this.value = String(n).padStart(2,'0');
        }
      });
    });

    // Press Enter on any filter to apply (demo alert) - validate date parts
    function applyFiltersDemo(){
      const r = filterRegion ? filterRegion.value : '';
      const s = filterSchool ? filterSchool.value.trim() : '';
      const d = formatDMY(filterDay ? filterDay.value : '', filterMonth ? filterMonth.value : '', filterYear ? filterYear.value : '');
      if(!isValidDMY(filterDay ? filterDay.value : '', filterMonth ? filterMonth.value : '', filterYear ? filterYear.value : '')){
        alert('Fecha invÃ¡lida. Verifica dÃ­a/mes/aÃ±o.');
        return;
      }
      alert(`Demo: Filters - Region: ${r || '(any)'}, School: ${s || '(any)'}, Date: ${d || '(any)'} `);
    }

    ['filterRegion','filterSchool','filterDay','filterMonth','filterYear'].forEach(id => {
      const el = document.getElementById(id);
      if(!el) return;
      el.addEventListener('keypress', function(e){
        if(e.key === 'Enter'){
          e.preventDefault();
          applyFiltersDemo();
        }
      });
    });

  </script>
</html>
