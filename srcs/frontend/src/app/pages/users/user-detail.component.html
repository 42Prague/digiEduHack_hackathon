<a routerLink="/users" class="btn secondary" [attr.title]="'user.back' | translate" style="margin-bottom:16px">← {{ 'user.back' | translate }}</a>
<div *ngIf="isLoading">{{ 'common.loading' | translate }}</div>
<div *ngIf="error" style="color:var(--danger)">{{ error }}</div>
<div *ngIf="user" class="card">
	<div class="card-header">
		<div>
			<div class="card-title">{{ user.name }} {{ user.surname }}</div>
			<div class="card-subtitle">{{ 'user.details' | translate }}</div>
		</div>
		<div>
			<div *ngIf="!isEditing" class="grid" style="grid-template-columns:auto;">
				<button class="btn secondary" (click)="enableEditing()">✏️ {{ 'common.edit' | translate }}</button>
			</div>
			<div *ngIf="isEditing" class="grid" style="grid-template-columns:auto auto; gap:8px">
				<button class="btn" [disabled]="form?.invalid || isSaving" (click)="save()">
					{{ isSaving ? ('common.saving' | translate) : ('common.saveChanges' | translate) }}
				</button>
				<button class="btn outline" [disabled]="isSaving" (click)="cancelEditing()">{{ 'common.cancel' | translate }}</button>
			</div>
		</div>
	</div>

	<!-- Meta -->
	<div class="grid cols-3">
		<div>
			<div class="muted">{{ 'user.id' | translate }}</div>
			<div><code>{{ user.id }}</code></div>
		</div>
		<div>
			<div class="muted">{{ 'user.accessLevel' | translate }}</div>
			<div><span class="badge">{{ user.accessLevel }}</span></div>
		</div>
		<div>
			<div class="muted">{{ 'common.mode' | translate }}</div>
			<div><span class="badge" [class.primary]="isEditing">{{ isEditing ? ('common.editing' | translate) : ('common.view' | translate) }}</span></div>
		</div>
	</div>
	<div class="spacer"></div>

	<!-- Details / Form -->
	<form *ngIf="form" [formGroup]="form" (ngSubmit)="save()">
		<div class="grid cols-2">
			<div>
				<h3>{{ 'common.basicInfo' | translate }}</h3>
				<div class="grid">
					<label>
						<div class="muted">{{ 'common.name' | translate }}</div>
						<input class="input" formControlName="name" [readonly]="!isEditing" [placeholder]="'user.firstName' | translate" />
					</label>
					<label>
						<div class="muted">{{ 'user.surname' | translate }}</div>
						<input class="input" formControlName="surname" [readonly]="!isEditing" [placeholder]="'user.lastName' | translate" />
					</label>
					<label>
						<div class="muted">{{ 'common.email' | translate }}</div>
						<input class="input" formControlName="email" [readonly]="!isEditing" [placeholder]="'login.emailPlaceholder' | translate" />
					</label>
				</div>
			</div>
			<div>
				<h3>{{ 'user.accessAndScope' | translate }}</h3>
				<div class="grid">
					<label>
						<div class="muted">{{ 'user.accessLevel' | translate }}</div>
						<select class="input" formControlName="accessLevel" [disabled]="!isEditing">
							<option [ngValue]="AccessLevel.Global">{{ 'access.global' | translate }}</option>
							<option [ngValue]="AccessLevel.Region">{{ 'access.region' | translate }}</option>
							<option [ngValue]="AccessLevel.School">{{ 'access.school' | translate }}</option>
						</select>
					</label>
					<label>
						<div class="muted">{{ 'region.id' | translate }}</div>
						<input class="input" formControlName="regionId" [readonly]="!isEditing" [placeholder]="'region.idExample' | translate" />
					</label>
					<label>
						<div class="muted">{{ 'school.id' | translate }}</div>
						<input class="input" formControlName="schoolId" [readonly]="!isEditing" [placeholder]="'school.idExample' | translate" />
					</label>
				</div>
			</div>
		</div>
		<div *ngIf="isEditing" style="margin-top:12px">
			<button class="btn" type="submit" [disabled]="form?.invalid || isSaving">{{ isSaving ? ('common.saving' | translate) : ('common.saveChanges' | translate) }}</button>
			<button class="btn ghost" type="button" [disabled]="isSaving" (click)="cancelEditing()">{{ 'common.cancel' | translate }}</button>
		</div>
	</form>
</div>

